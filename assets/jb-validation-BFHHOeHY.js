var x=Object.defineProperty;var w=s=>{throw TypeError(s)};var C=(s,t,i)=>t in s?x(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var A=(s,t,i)=>C(s,typeof t!="symbol"?t+"":t,i),y=(s,t,i)=>t.has(s)||w("Cannot "+i);var e=(s,t,i)=>(y(s,t,"read from private field"),i?i.call(s):t.get(s)),g=(s,t,i)=>t.has(s)?w("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),v=(s,t,i,a)=>(y(s,t,"write to private field"),a?a.call(s,i):t.set(s,i),i),f=(s,t,i)=>(y(s,t,"access private method"),i);function j(s,t,i){const{syncValidationResult:a}=k(s,t,i);return a}async function G(s,t,i){const{syncValidationResult:a,asyncList:l}=k(s,t,i);for(const r of l){const d=await r;a.isAllValid=a.isAllValid&&d.isValid,a.validationList.push(d)}return a}function k(s,t,i){const a={validationList:[],isAllValid:!0},l=u=>{a.validationList.push(u),u.isValid||(a.isAllValid=!1)},r=s.filter(u=>u.defer===!0),d=s.filter(u=>u.defer!==!0),h=[];for(const u of d){const c=L(t,u,i);c instanceof Promise?h.push(c):l(c)}if(a.isAllValid)for(const u of r){const c=L(t,u,i);c instanceof Promise?h.push(c):l(c)}return{syncValidationResult:a,asyncList:h}}function L(s,t,i){let a,l=t.message;if(t.validator instanceof RegExp){const r=typeof s=="string"?s:i(s);a=t.validator.test(r),t.validator.lastIndex=0}if(typeof t.validator=="function"){const r=I(t.validator,s);if(r instanceof Promise)return new Promise(d=>{r.then(h=>{d({isValid:h.isValid,message:h.message,validation:t})})});a=r.isValid,l=r.message??l}return t.validator===void 0&&(a=!1),a?{isValid:!0,message:"",validation:t}:{isValid:!1,message:l,validation:t}}function I(s,t){function i(l){let r=null;return typeof l=="string"&&l.length>0&&(r=l),{isValid:typeof l=="string"?l.length==0:l,message:r}}const a=s(t);return a instanceof Promise?new Promise(l=>{a.then(r=>{l(i(r))})}):i(a)}var V,m,n,o,p,E,R,S,b,P,q=(P=class{constructor(s){g(this,o);g(this,V,[]);g(this,m,{isValid:null,message:null});A(this,"result",null);g(this,n,{clearValidationError:[],getValue:()=>null,getValidations:[],getValueString:()=>"",setValidationResult:[],showValidationError:[]});this.setCallbacks(s)}get resultSummary(){return e(this,m)}setCallbacks(s){Object.keys(s).forEach(t=>{typeof s[t]=="function"&&e(this,n)[t]!==void 0&&(Array.isArray(e(this,n)[t])?e(this,n)[t].push(s[t]):e(this,n)[t]=s[t])})}get list(){return e(this,V)}set list(s){v(this,V,s),this.checkValidity({showError:!1})}async checkValidity(s){const t=(s==null?void 0:s.value)||await Promise.resolve(e(this,n).getValue()),i=await f(this,o,S).call(this,t);return f(this,o,E).call(this,i,s),i}checkValiditySync(s){const t=(s==null?void 0:s.value)||e(this,n).getValue(),i=f(this,o,b).call(this,t);return f(this,o,E).call(this,i,s),i}addValidationListGetter(s){e(this,n).getValidations.push(s)}},V=new WeakMap,m=new WeakMap,n=new WeakMap,o=new WeakSet,p=function(){return[...f(this,o,R).call(this),...e(this,V)]},E=function(s,t){if(v(this,m,{isValid:s.isAllValid,message:null}),s.isAllValid)e(this,n).clearValidationError.forEach(i=>i());else{const i=s.validationList.find(a=>!a.isValid);this.resultSummary.message=i.message,(t==null?void 0:t.showError)!==!1&&e(this,n).showValidationError.forEach(a=>a({message:i.message}))}this.result=s,e(this,n).setValidationResult.forEach(i=>i(s))},R=function(){const s=[];return e(this,n).getValidations.forEach(t=>{typeof t=="function"&&s.push(...t())}),s.flat()},S=async function(s){return await G(e(this,o,p),s,e(this,n).getValueString)},b=function(s){return j(e(this,o,p),s,e(this,n).getValueString)},P);export{q as e};
