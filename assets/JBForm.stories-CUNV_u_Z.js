var Be=Object.defineProperty;var _=i=>{throw TypeError(i)};var Ie=(i,t,e)=>t in i?Be(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var b=(i,t,e)=>Ie(i,typeof t!="symbol"?t+"":t,e),q=(i,t,e)=>t.has(i)||_("Cannot "+e);var n=(i,t,e)=>(q(i,t,"read from private field"),e?e.call(i):t.get(i)),g=(i,t,e)=>t.has(i)?_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),F=(i,t,e,a)=>(q(i,t,"write to private field"),a?a.call(i,e):t.set(i,e),e),h=(i,t,e)=>(q(i,t,"access private method"),e);import{R as o,r as v}from"./index-D4lIrffr.js";import{o as E}from"./JBButton-BY-RhsYB.js";import{i as K}from"./JBDateInput-BK89NgWS.js";import{c as ce}from"./JBInput-JrhZOR5V.js";import{u as Je,a as Le}from"./index-ce-5tJlN.js";import{o as Re}from"./JBTextarea-DXvovlO2.js";import{s as Ae}from"./JBPaymentInput-CccNG2IM.js";import{l as xe}from"./JBImageInput-7U7K0v3u.js";import"./jb-loading-ChdSv5sn.js";import"./index-B65NTg4l.js";import"./jb-date-input-B-CWo3lr.js";import"./jb-calendar-B-ykEWtJ.js";import"./index-BEepDcv4.js";import"./index-Bvsa8z4z.js";import"./jb-validation-BFHHOeHY.js";import"./jb-popover-CcpVroQC.js";import"./index-CTKrnuEF.js";function f(i,t,e,a){if(e==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!a:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?a:e==="a"?a.call(i):a?a.value:t.get(i)}function de(i,t,e,a,r){if(typeof t=="function"?i!==t||!0:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(i,e),e}function Me(i,t,e){const{syncValidationResult:a}=me(i,t,e);return a}async function je(i,t,e){const{syncValidationResult:a,asyncList:r}=me(i,t,e);for(const s of r){const u=await s;a.isAllValid=a.isAllValid&&u.isValid,a.validationList.push(u)}return a}function me(i,t,e){const a={validationList:[],isAllValid:!0},r=d=>{a.validationList.push(d),d.isValid||(a.isAllValid=!1)},s=i.filter(d=>d.defer===!0),u=i.filter(d=>d.defer!==!0),m=[];for(const d of u){const l=Q(t,d,e);l instanceof Promise?m.push(l):r(l)}if(a.isAllValid)for(const d of s){const l=Q(t,d,e);l instanceof Promise?m.push(l):r(l)}return{syncValidationResult:a,asyncList:m}}function Q(i,t,e){let a,r=t.message;if(t.validator instanceof RegExp){const s=typeof i=="string"?i:e(i);a=t.validator.test(s),t.validator.lastIndex=0}if(typeof t.validator=="function"){const s=$e(t.validator,i);if(s instanceof Promise)return new Promise(u=>{s.then(m=>{u({isValid:m.isValid,message:m.message,validation:t})})});a=s.isValid,r=s.message??r}return a?{isValid:!0,message:"",validation:t}:{isValid:!1,message:r,validation:t}}function $e(i,t){function e(r){let s=null;return typeof r=="string"&&r.length>0&&(s=r),{isValid:typeof r=="string"?r.length==0:r,message:s}}const a=i(t);return a instanceof Promise?new Promise(r=>{a.then(s=>{r(e(s))})}):e(a)}var S,I,W,V,O,N,U,fe,he;class Pe{get resultSummary(){return f(this,W,"f")}constructor(t){S.add(this),I.set(this,[]),W.set(this,{isValid:null,message:null}),this.result=null,V.set(this,{clearValidationError:[],getValue:()=>null,getValidations:[],getValueString:()=>"",setValidationResult:[],showValidationError:[]}),this.setCallbacks(t)}setCallbacks(t){Object.keys(t).forEach(e=>{typeof t[e]=="function"&&f(this,V,"f")[e]!==void 0&&(Array.isArray(f(this,V,"f")[e])?f(this,V,"f")[e].push(t[e]):f(this,V,"f")[e]=t[e])})}get list(){return f(this,I,"f")}set list(t){de(this,I,t),this.checkValidity({showError:!1})}async checkValidity(t){const e=(t==null?void 0:t.value)||await Promise.resolve(f(this,V,"f").getValue()),a=await f(this,S,"m",fe).call(this,e);return f(this,S,"m",N).call(this,a,t),a}checkValiditySync(t){const e=(t==null?void 0:t.value)||f(this,V,"f").getValue(),a=f(this,S,"m",he).call(this,e);return f(this,S,"m",N).call(this,a,t),a}addValidationListGetter(t){f(this,V,"f").getValidations.push(t)}}I=new WeakMap,W=new WeakMap,V=new WeakMap,S=new WeakSet,O=function(){return[...f(this,S,"m",U).call(this),...f(this,I,"f")]},N=function(i,t){if(de(this,W,{isValid:i.isAllValid,message:null}),i.isAllValid)f(this,V,"f").clearValidationError.forEach(e=>e());else{const e=i.validationList.find(a=>!a.isValid);this.resultSummary.message=e.message,(t==null?void 0:t.showError)!==!1&&f(this,V,"f").showValidationError.forEach(a=>a({message:e.message}))}this.result=i,f(this,V,"f").setValidationResult.forEach(e=>e(i))},U=function(){const i=[];return f(this,V,"f").getValidations.forEach(t=>{typeof t=="function"&&i.push(...t())}),i.flat()},fe=async function(i){return await je(f(this,S,"a",O),i,f(this,V,"f").getValueString)},he=function(i){return Me(f(this,S,"a",O),i,f(this,V,"f").getValueString)};var J,X,ge=(X=class{constructor(i){b(this,"name");b(this,"validation");b(this,"dom");b(this,"getValue");b(this,"getDirtyStatus");b(this,"setValue");b(this,"setInitialValue");g(this,J);b(this,"dispatchOnChange",()=>{n(this,J).onChange()});this.name=i.name,this.validation=i.validation,this.dom=i.dom,this.getDirtyStatus=i.getDirtyStatus,this.getValue=i.getValue,this.setInitialValue=i.setInitialValue,this.setValue=i.setValue}attachCallbacks(i){F(this,J,i)}},J=new WeakMap,X),C,L,R,Z,Te=(Z=class{constructor(i){g(this,C,[]);g(this,L,{});g(this,R);b(this,"add",i=>{const t=new ge(i);return t.attachCallbacks({onChange:()=>n(this,R).handleStateChanges(t)}),n(this,C).push(t),n(this,L)[t.name]=t,t});F(this,R,i)}get list(){return[...n(this,C)]}get dictionary(){return n(this,L)}setValues(i){for(const t of n(this,C))t.name&&i[t.name]!==void 0&&typeof t.setValue=="function"&&t.setValue(i[t.name])}setInitialValues(i){for(const t of n(this,C))t.name&&i[t.name]!==void 0&&typeof t.setInitialValue=="function"&&t.setInitialValue(i[t.name])}traverse(i){const t={};for(const e of n(this,C))e.name&&(t[e.name]=i(e));return t}},C=new WeakMap,L=new WeakMap,R=new WeakMap,Z),k,A,ee,We=(ee=class{constructor(){g(this,k,[]);g(this,A,{})}get list(){return[...n(this,k)]}get dictionary(){return Object.freeze({...n(this,A)})}setValues(i){for(const t of n(this,k))t.name&&i[t.name]!==void 0&&t.setFormValues(i[t.name],!1)}setInitialValues(i){for(const t of n(this,k))t.name&&i[t.name]!==void 0&&t.setFormInitialValues(i[t.name],!1)}traverse(i){const t={};for(const e of n(this,k))e.name&&(t[e.name]=i(e));return t}add(i){n(this,k).includes(i)||(n(this,k).push(i),i.name&&(n(this,A)[i.name]=i))}},k=new WeakMap,A=new WeakMap,ee),z,H,y,p,x,c,Ve,ye,pe,ve,be,Ee,ke,w,M,j,Y,Se,Ce,we,De,D,qe=(D=class extends HTMLFormElement{constructor(){super();g(this,c);g(this,z,this.checkValidity);g(this,H,this.reportValidity);g(this,y,new Te({handleStateChanges:h(this,c,Y).bind(this)}));g(this,p,new We);b(this,"callbacks",{showValidationError:e=>{},cleanValidationError:()=>{},setValidationResult:()=>{}});g(this,x,new Pe({showValidationError:this.callbacks.showValidationError.bind(this),clearValidationError:this.callbacks.cleanValidationError.bind(this),getValue:this.getFormValues.bind(this),getValidations:h(this,c,pe).bind(this),getValueString:e=>JSON.stringify(e),setValidationResult:this.callbacks.setValidationResult}));g(this,M,!1);g(this,j,this.checkValidity());this.initWebComponent()}get validation(){return n(this,x)}get isDirty(){const e=this.getFormDirtyStatus();return Object.values(e).includes(!0)}get value(){return this.getFormValues()}get virtualElements(){return{list:n(this,y).list,dictionary:n(this,y).dictionary,add:n(this,y).add}}get subForms(){return{list:n(this,p).list,dictionary:n(this,p).dictionary}}initWebComponent(){h(this,c,Ve).call(this),this.checkValidity=h(this,c,ve),this.reportValidity=h(this,c,be),h(this,c,Se).call(this)}connectedCallback(){h(this,c,Ce).call(this)}static get observedAttributes(){return[]}attributeChangedCallback(e,a,r){h(this,c,De).call(this,e,r)}async jbCheckValidity(e){var r,s;const a={isAllValid:!0,elements:new Map,virtualElements:new Map,subForms:new Map};for(const u of this.elements){const m=u;if(typeof((r=m.validation)==null?void 0:r.checkValidity)=="function"){const d=await m.validation.checkValidity({showError:e.showError});a.isAllValid=d.isAllValid&&a.isAllValid,a.elements.set(m,d)}}for(const u of n(this,y).list)if(typeof((s=u.validation)==null?void 0:s.checkValidity)=="function"){const m=await u.validation.checkValidity({showError:e.showError});a.isAllValid=m.isAllValid&&a.isAllValid,a.virtualElements.set(u,m)}for(const u of n(this,p).list){const m=await u.jbCheckValidity(e);a.isAllValid=m.isAllValid&&a.isAllValid,a.subForms.set(u,m)}return a}getValidationMessages(){return h(this,c,w).call(this,e=>e.validationMessage??null,e=>{var a,r;return((r=(a=e.validation)==null?void 0:a.resultSummary)==null?void 0:r.message)??null},e=>e.validation.resultSummary.message??null)}getValidationSummary(){return h(this,c,w).call(this,e=>{var a;return((a=e.validation)==null?void 0:a.resultSummary)??null},e=>{var a;return((a=e.validation)==null?void 0:a.resultSummary)??null},e=>e.validation.resultSummary)}getValidationResult(){return h(this,c,w).call(this,e=>{var a;return((a=e.validation)==null?void 0:a.result)??null},e=>{var a;return((a=e.validation)==null?void 0:a.result)??null},e=>e.validation.result)}getFormValues(){return h(this,c,w).call(this,e=>e.value,e=>typeof e.getValue=="function"?e.getValue():null,e=>e.getFormValues())}getFormDirtyStatus(){return h(this,c,w).call(this,e=>e.isDirty,e=>typeof e.getDirtyStatus=="function"?e.getDirtyStatus():null,e=>e.isDirty)}setFormValues(e,a=!0){for(const r of this.elements){const s=r;s.name&&e[s.name]!==void 0&&(s.value=e[s.name])}n(this,y).setValues(e),n(this,p).setValues(e),a&&this.setFormInitialValues(e,!1)}setFormInitialValues(e,a=!0){for(const r of this.elements){const s=r;s.name&&e[s.name]!==void 0&&(s.initialValue=e[s.name])}n(this,y).setInitialValues(e),n(this,p).setInitialValues(e),a&&this.setFormValues(e,!1)}},z=new WeakMap,H=new WeakMap,y=new WeakMap,p=new WeakMap,x=new WeakMap,c=new WeakSet,Ve=function(){this.addEventListener("submit",e=>h(this,c,ye).call(this,e),{passive:!1}),this.addEventListener("change",e=>{const a=e.target;h(this,c,Y).call(this,a)},{passive:!0})},ye=function(e){e.isTrusted&&(e.stopPropagation(),e.preventDefault(),this.reportValidity()&&h(this,c,Ee).call(this,e))},pe=function(){return[{validator:()=>{for(const e of this.elements){const a=e;if(typeof a.checkValidity=="function"&&a.checkValidity()==0)return a.validationMessage!=""&&a.validationMessage}return!0},message:"form element is invalid"},{validator:()=>{const e=n(this,y).list.find(a=>{var r;return typeof((r=a.validation)==null?void 0:r.checkValidity)=="function"&&!a.validation.checkValidity({showError:!1})});if(e==null)return!0;e.validation.resultSummary.message},message:"virtual element is invalid"},{validator:()=>{const e=n(this,p).list.find(a=>!a.checkValidity());if(e==null)return!0;e.validation.resultSummary.message},message:"form element is invalid"}]},ve=function(){return n(this,x).checkValiditySync({showError:!1}).isAllValid},be=function(){let e=!0;for(const s of this.elements){const u=s;typeof u.reportValidity=="function"&&(e=u.reportValidity()&&e)}const a=n(this,y).list.reduce((s,u)=>{var m;return(typeof((m=u.validation)==null?void 0:m.checkValidity)!="function"||u.validation.checkValiditySync({showError:!0}))&&s},!0),r=n(this,p).list.reduce((s,u)=>u.reportValidity()&&s,!0);return e&&a&&r},Ee=function(e){const a=new SubmitEvent("submit",{...e});this.dispatchEvent(a)},ke=function(e){const a={};for(const r of this.elements)r.name&&(a[r.name]=e(r));return a},w=function(e,a,r){return{...h(this,c,ke).call(this,e),...n(this,y).traverse(a),...n(this,p).traverse(r)}},M=new WeakMap,j=new WeakMap,Y=function(e){const a=()=>{const s=this.isDirty;if(s!==n(this,M)){const u=new CustomEvent("dirty-change",{bubbles:!1,cancelable:!1,composed:!0,detail:{isDirty:s}});this.dispatchEvent(u),F(this,M,s)}},r=()=>{const s=this.checkValidity();if(s!==n(this,j)){const u=new CustomEvent("validity-change",{bubbles:!1,cancelable:!1,composed:!0,detail:{isValid:s}});this.dispatchEvent(u),F(this,j,s)}};if(e instanceof ge)return h(this,c,we).call(this),a(),void r();e.isDirty!==void 0&&a(),typeof e.checkValidity=="function"&&r()},Se=function(){this.addEventListener("init",e=>{e.target instanceof D&&e.target!==this&&n(this,p).add(e.target)})},Ce=function(){const e=new CustomEvent("init",{bubbles:!0,composed:!0,cancelable:!1});this.dispatchEvent(e)},we=function(){const e=new Event("change",{bubbles:!0,cancelable:!1,composed:!0});this.dispatchEvent(e)},De=function(e,a){},D);!customElements.get("jb-form")&&window.customElements.define("jb-form",qe,{extends:"form"});function B(i,t,e,a=!1){let r=v.useCallback(s=>{i.current&&typeof e=="function"&&e(s)},[i,e]);v.useEffect(()=>{let s=i.current;return s&&s.addEventListener(t,r,{passive:a,capture:!1}),function(){s&&s.removeEventListener(t,r,{passive:a,capture:!1})}},[i,t,e,a])}let Oe=v.createContext(null),Ne=Oe.Provider,G=o.forwardRef((i,t)=>{var e;let{onSubmit:a,onValidityChange:r,onDirtyChange:s,children:u,...m}=i,d=o.useRef(null);return v.useImperativeHandle(t,()=>d.current??void 0,[d]),B(d,"load",(e={onSubmit:a,onValidityChange:r,onDirtyChange:s}).onLoad,!0),B(d,"init",e.onInit,!0),B(d,"validity-change",e.onValidityChange),B(d,"dirty-change",e.onDirtyChange),B(d,"submit",e.onSubmit),o.createElement("form",{is:"jb-form",ref:d,...m},o.createElement(Ne,{value:d.current??null},u))});G.displayName="JBForm";const Ye=["male","female"];function Fe(){return o.createElement("div",null,o.createElement(ce,{name:"name",required:!0,label:"نام"}),o.createElement(K,{name:"birthDate",required:!0,label:"تاریخ تولد",format:"YYYY-MM-DD"}),o.createElement(K,{name:"applyDate",required:!0,label:"apply date"}),o.createElement(Je,{name:"gender",label:"جنسیت",required:!0},o.createElement(Le,{optionList:Ye})),o.createElement(xe,{name:"avatar",label:"نمایه",required:!0,maxFileSize:500*1024}),o.createElement(Re,{label:"توضیحات",name:"description",required:!0}))}function ze(){return o.createElement("div",null,o.createElement(ce,{name:"bankName",required:!0,label:"نام بانک"}),o.createElement(Ae,{name:"cardNumber",label:"شماره کارت"}))}const dt={title:"Components/form elements/JBForm",component:G},$={args:{name:"testForm"}},He={name:"ali",birthDate:"2024-10-26",applyDate:new Date().toISOString(),gender:"male",description:"i'm ali",avatar:"https://www.wikipedia.org/portal/wikipedia.org/assets/img/Wikipedia-logo-v2.png"},P={render:i=>{const t=v.useRef(null),[e,a]=v.useState(!1),[r,s]=v.useState(!0),u=()=>{alert("submit")},m=l=>{a(l.detail.isDirty)},d=l=>{s(l.detail.isValid)};return v.useEffect(()=>{t.current&&s(t.current.checkValidity())},[t]),o.createElement(G,{ref:t,...i,style:{display:"flex",flexDirection:"column",gap:"1rem"},onSubmit:u,onDirtyChange:m,onValidityChange:d},o.createElement(Fe,null),o.createElement("div",{style:{display:"flex",gap:"1rem"}},o.createElement(E,{disabled:!e,type:"submit"},"submit"),o.createElement(E,{onClick:()=>{var l;return alert((l=t.current)==null?void 0:l.checkValidity())}},"check validity(",r?"valid":"invalid",")"),o.createElement(E,{onClick:()=>{var l;return alert((l=t.current)==null?void 0:l.reportValidity())}},"report validity"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.getValidationMessages())}},"getValidationMessages"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.getValidationSummary())}},"getValidationSummary"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.getValidationResult())}},"getValidationResult"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.getFormValues())}},"getFormValues"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.setFormValues(He,!0))}},"setFormDefaultValue"),o.createElement(E,{onClick:()=>{var l;return console.debug((l=t.current)==null?void 0:l.getFormDirtyStatus())}},"getFormDirtyStatus")))},args:{name:"test-form"}},T={render:i=>{const t=v.useRef(null),[e,a]=v.useState(!1),[r,s]=v.useState(!0),u=()=>{alert("submit")},m=l=>{a(l.detail.isDirty)},d=l=>{s(l.detail.isValid)};return v.useEffect(()=>{t.current&&(s(t.current.checkValidity()),t.current.addEventListener("submit",u),t.current.addEventListener("dirty-change",m),t.current.addEventListener("validity-change",d))},[t]),o.createElement("form",{is:"jb-form",ref:t,...i,style:{display:"flex",flexDirection:"column",gap:"1rem"}},o.createElement("form",{is:"jb-form",name:"personForm"},o.createElement(Fe,null)),o.createElement("hr",null),o.createElement("form",{is:"jb-form",name:"bank-form"},o.createElement(ze,null)),o.createElement("div",null,"isDirty:",e?"dirty":"clean"),o.createElement("div",null,"isValid:",r?"valid":"invalid"))},args:{name:"parent-form"}};var te,ie,ae;$.parameters={...$.parameters,docs:{...(te=$.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    name: "testForm"
  }
}`,...(ae=(ie=$.parameters)==null?void 0:ie.docs)==null?void 0:ae.source}}};var se,re,ne;P.parameters={...P.parameters,docs:{...(se=P.parameters)==null?void 0:se.docs,source:{originalSource:`{
  render: args => {
    const ref = useRef<JBFormWebComponent>(null);
    const [isDirty, setIsDirty] = useState(false);
    const [isValid, setIsValid] = useState(true);
    const onSubmit = () => {
      alert("submit");
    };
    const onDirtyChange = e => {
      setIsDirty(e.detail.isDirty);
    };
    const onValidityChange = e => {
      setIsValid(e.detail.isValid);
    };
    useEffect(() => {
      if (ref.current) {
        setIsValid(ref.current.checkValidity());
      }
    }, [ref]);
    return <JBForm ref={ref} {...args} style={{
      display: 'flex',
      flexDirection: "column",
      gap: '1rem'
    }} onSubmit={onSubmit} onDirtyChange={onDirtyChange} onValidityChange={onValidityChange}>
          <PersonForm />
          <div style={{
        display: 'flex',
        gap: '1rem'
      }}>
            <JBButton disabled={!isDirty} type="submit">submit</JBButton>
            <JBButton onClick={() => alert(ref.current?.checkValidity())}>check validity({isValid ? 'valid' : 'invalid'})</JBButton>
            <JBButton onClick={() => alert(ref.current?.reportValidity())}>report validity</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.getValidationMessages())}>getValidationMessages</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.getValidationSummary())}>getValidationSummary</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.getValidationResult())}>getValidationResult</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.getFormValues())}>getFormValues</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.setFormValues(defaultFormValue, true))}>setFormDefaultValue</JBButton>
            <JBButton onClick={() => console.debug(ref.current?.getFormDirtyStatus())}>getFormDirtyStatus</JBButton>
          </div>
        </JBForm>;
  },
  args: {
    name: "test-form"
  }
}`,...(ne=(re=P.parameters)==null?void 0:re.docs)==null?void 0:ne.source}}};var le,oe,ue;T.parameters={...T.parameters,docs:{...(le=T.parameters)==null?void 0:le.docs,source:{originalSource:`{
  render: args => {
    const ref = useRef<JBFormWebComponent>(null);
    const [isDirty, setIsDirty] = useState(false);
    const [isValid, setIsValid] = useState(true);
    const onSubmit = () => {
      alert("submit");
    };
    const onDirtyChange = e => {
      setIsDirty(e.detail.isDirty);
    };
    const onValidityChange = e => {
      setIsValid(e.detail.isValid);
    };
    useEffect(() => {
      if (ref.current) {
        setIsValid(ref.current.checkValidity());
        ref.current.addEventListener('submit', onSubmit);
        ref.current.addEventListener('dirty-change', onDirtyChange);
        ref.current.addEventListener('validity-change', onValidityChange);
      }
    }, [ref]);
    return <form is="jb-form" ref={ref} {...args} style={{
      display: 'flex',
      flexDirection: "column",
      gap: '1rem'
    }}>
          <form is="jb-form" name="personForm">
            <PersonForm></PersonForm>
          </form>
          <hr></hr>
          <form is="jb-form" name="bank-form">
            <BankForm />
          </form>
          <div>isDirty:{isDirty ? 'dirty' : 'clean'}</div>
          <div>isValid:{isValid ? 'valid' : 'invalid'}</div>
        </form>;
  },
  args: {
    name: "parent-form"
  }
}`,...(ue=(oe=T.parameters)==null?void 0:oe.docs)==null?void 0:ue.source}}};const mt=["Normal","FormTest","FormTreeTest"];export{P as FormTest,T as FormTreeTest,$ as Normal,mt as __namedExportsOrder,dt as default};
